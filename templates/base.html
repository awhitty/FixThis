{% load staticfiles %}
<!DOCTYPE html> 
<html> 
<head> 
	<title>FixThis</title> 

	<meta name="apple-mobile-web-app-capable" content="yes">
 	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="viewport" content="width=device-width, initial-scale=1"> 

	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.css" />
	<link rel="stylesheet" type="text/css" href="{% static "css/master.css" %}">

	<!-- libraries -->
	<script src="http://code.jquery.com/jquery-1.8.2.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.js"></script>
	<script src="http://malsup.github.com/jquery.form.js"></script>
	<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
	<script type="text/javascript" src="https://raw.github.com/HPNeo/gmaps/master/gmaps.js"></script>
	<script type="text/javascript" src="https://raw.github.com/carhartl/jquery-cookie/master/jquery.cookie.js"></script>
	<script type="text/javascript" src="https://raw.github.com/bradbirdsall/Swipe/master/swipe.min.js"></script>
	{# <script src="http://documentcloud.github.com/underscore/underscore.js"></script> #}
	{# <script src="http://backbonejs.org/backbone.js"></script> #}

	<!-- app -->

	<script type="text/javascript">
		$(window).on('pageinit', function() {
			if(!($.cookie('userLat')&&$.cookie('userLon'))) {
				updateLocation();
			}
		}) 
		function updateLocation() {
			GMaps.geolocate({
				success: function(position) {
					$.removeCookie('userLat');
					$.removeCookie('userLon');
  			  		$.cookie('userLat', position.coords.latitude)
  			  		$.cookie('userLon', position.coords.longitude)
  			  		console.log("Finished locating user and set a cookie")
  				},
  				// error: function() {
  				// 	alert("Many features will not work without your location. Please consider enabling location services.")
  				// }
			})
		}
	</script>
</head> 
<body>
	<div id="{% block id %}{% endblock id %}" data-role="page">
		<script src="//cdn.optimizely.com/js/141765726.js"></script>
		{% if messages %}
			<ul class="messages">
    		{% for message in messages %}
    			<li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
    		{% endfor %}
			</ul>
		{% endif %}
		{% block content %}{% endblock content %}
	</div>

	<script type="text/javascript">
			// The following code is from https://docs.djangoproject.com/en/dev/ref/contrib/csrf/#ajax
			var csrftoken = $.cookie('csrftoken');

			function csrfSafeMethod(method) {
			    // these HTTP methods do not require CSRF protection
			    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
			}
			$.ajaxSetup({
			    crossDomain: false, // obviates need for sameOrigin test
			    beforeSend: function(xhr, settings) {
			        if (!csrfSafeMethod(settings.type)) {
			            xhr.setRequestHeader("X-CSRFToken", csrftoken);
			        }
			    }
			});
	</script>
</body>
</html>
